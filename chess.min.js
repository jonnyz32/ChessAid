for(var board=[],green="chartreuse",playerColour="w",boardSize=0,i=0;i<8;i++)board.push(["","","","","","","",""]);var resetBoard=function(){for(var r=0;r<8;r++)for(var o=0;o<8;o++)board[r][o]=""},underAttackByRook=function(r,o){for(var e=[],a=board[r][o][0],l=o-1;!(l<0);){if(board[r][l]){board[r][l][0]===playerColour&&a!==playerColour&&e.push([r,l,"red"]),board[r][l][0]!==playerColour&&a===playerColour&&e.push([r,l,green]);break}a!==playerColour&&e.push([r,l,"orange"]),l-=1}for(l=o+1;!(l>=8);){if(board[r][l]){board[r][l][0]===playerColour&&a!==playerColour&&e.push([r,l,"red"]),board[r][l][0]!==playerColour&&a===playerColour&&e.push([r,l,green]);break}a!==playerColour&&e.push([r,l,"orange"]),l+=1}for(var u=r-1;!(u<0);){if(board[u][o]){board[u][o][0]===playerColour&&a!==playerColour&&e.push([u,o,"red"]),board[u][o][0]!==playerColour&&a===playerColour&&e.push([u,o,green]);break}a!==playerColour&&e.push([u,o,"orange"]),u-=1}for(u=r+1;!(u>=8);){if(board[u][o]){board[u][o][0]===playerColour&&a!==playerColour&&e.push([u,o,"red"]),board[u][o][0]!==playerColour&&a===playerColour&&e.push([u,o,green]);break}a!==playerColour&&e.push([u,o,"orange"]),u+=1}return e},underAttackByKnight=function(r,o){for(var e=board[r][o][0],a=[],l=[[-1,-2],[-2,-1],[-2,1],[-1,2],[1,2],[2,1],[2,-1],[1,-2]],u=0,t=l;u<t.length;u++){var n=t[u];r+n[0]>=0&&o+n[1]>=0&&r+n[0]<8&&o+n[1]<8&&(board[r+n[0]][o+n[1]]?board[r+n[0]][o+n[1]][0]===playerColour&&e!==playerColour?a.push([r+n[0],o+n[1],"red"]):board[r+n[0]][o+n[1]][0]!==playerColour&&e===playerColour&&a.push([r+n[0],o+n[1],green]):e!==playerColour&&a.push([r+n[0],o+n[1],"orange"]))}return a},underAttackByKing=function(r,o){for(var e=board[r][o][0],a=[],l=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],u=0,t=l;u<t.length;u++){var n=t[u];r+n[0]>=0&&o+n[1]>=0&&r+n[0]<8&&o+n[1]<8&&(board[r+n[0]][o+n[1]]?board[r+n[0]][o+n[1]][0]===playerColour&&e!==playerColour?a.push([r+n[0],o+n[1],"red"]):board[r+n[0]][o+n[1]][0]!==playerColour&&e===playerColour&&a.push([r+n[0],o+n[1],green]):e!==playerColour&&a.push([r+n[0],o+n[1],"orange"]))}return a},underAttackByBishop=function(r,o){for(var e=board[r][o][0],a=[],l=r-1,u=o-1;!(l<0||u<0);){if(board[l][u]){board[l][u][0]===playerColour&&e!==playerColour?a.push([l,u,"red"]):board[l][u][0]!==playerColour&&e===playerColour&&a.push([l,u,green]);break}e!==playerColour&&a.push([l,u,"orange"]),l-=1,u-=1}for(l=r-1,u=o+1;!(l<0||u>=8);){if(board[l][u]){board[l][u][0]===playerColour&&e!==playerColour?a.push([l,u,"red"]):board[l][u][0]!==playerColour&&e===playerColour&&a.push([l,u,green]);break}e!==playerColour&&a.push([l,u,"orange"]),l-=1,u+=1}for(l=r+1,u=o-1;!(l>=8||u<0);){if(board[l][u]){board[l][u][0]===playerColour&&e!==playerColour?a.push([l,u,"red"]):board[l][u][0]!==playerColour&&e===playerColour&&a.push([l,u,green]);break}e!==playerColour&&a.push([l,u,"orange"]),l+=1,u-=1}for(l=r+1,u=o+1;!(l>=8||u>=8);){if(board[l][u]){board[l][u][0]===playerColour&&e!==playerColour?a.push([l,u,"red"]):board[l][u][0]!==playerColour&&e===playerColour&&a.push([l,u,green]);break}e!==playerColour&&a.push([l,u,"orange"]),l+=1,u+=1}return a},init=function(){var r=document.querySelector("#game-board").classList.contains("flipped");r&&(playerColour="b"),getPiecePositions(),document.querySelector(".arrows-container").style.position="relative",boardSize=document.querySelector(".arrows-container").clientHeight/8},getPiecePositions=function(){var r=document.querySelector("#game-board").classList.contains("flipped");playerColour=r?"b":"w";for(var o=document.querySelector(".pieces").childNodes,e=0,a=o;e<a.length;e++){var l=a[e],u=l.classList[1].split("-")[1],t=parseInt(u[1]),n=parseInt(u[3]),p=l.style.backgroundImage.split("/")[7].substring(0,2);"w"===playerColour?board[8-n][t-1]=p:board[n-1][8-t]=p}return board},underAttackByPawn=function(r,o){var e=[],a=board[r][o][0];return a!==playerColour?(r+1<8&&o-1>=0&&(board[r+1][o-1]&&board[r+1][o-1][0]===playerColour?e.push([r+1,o-1,"red"]):board[r+1][o-1]||e.push([r+1,o-1,"orange"])),r+1<8&&o+1<8&&(board[r+1][o+1]&&board[r+1][o+1][0]===playerColour?e.push([r+1,o+1,"red"]):board[r+1][o+1]||e.push([r+1,o+1,"orange"]))):(r-1<8&&o-1>=0&&board[r-1][o-1]&&board[r-1][o-1][0]!==playerColour&&e.push([r-1,o-1,green]),r+1<8&&o+1<8&&board[r-1][o+1]&&board[r-1][o+1][0]!==playerColour&&e.push([r-1,o+1,green])),e},getPiecesUnderAttack=function(){for(var r=[],o=0;o<8;o++)for(var e=0;e<8;e++)board[o][e]&&("p"===board[o][e][1]?r=r.concat(underAttackByPawn(o,e)):"r"===board[o][e][1]?r=r.concat(underAttackByRook(o,e)):"b"===board[o][e][1]?r=r.concat(underAttackByBishop(o,e)):"q"===board[o][e][1]?(r=r.concat(underAttackByBishop(o,e)),r=r.concat(underAttackByRook(o,e))):"n"===board[o][e][1]?r=r.concat(underAttackByKnight(o,e)):"k"===board[o][e][1]&&(r=r.concat(underAttackByKing(o,e))));return r},highlightSquareByCoordinate=function(r,o,e){var a=o*boardSize,l=r*boardSize,u=document.createElement("div");u.className="highlights",u.style.position="absolute",u.style.width=boardSize+"px",u.style.height=boardSize+"px",u.style.background=e,u.style.opacity="orange"===e?"0.5":"1",u.style.left=a+"px",u.style.top=l+"px",document.querySelector(".arrows-container").appendChild(u)},deleteHighlights=function(){for(var r=document.getElementsByClassName("highlights");r.length>0;)r[0].remove()},mainLoop=function(){resetBoard(),getPiecePositions(),deleteHighlights();for(var r=getPiecesUnderAttack(),o=0,e=r;o<e.length;o++){var a=e[o];highlightSquareByCoordinate(a[0],a[1],a[2])}};init();var interval=window.setInterval(mainLoop,750);